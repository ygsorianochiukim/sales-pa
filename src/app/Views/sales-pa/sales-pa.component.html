<div class="w-full h-dvh flex flex-col">
  <div class="p-5 flex flex-col gap-3 items-start">
    <span [routerLink]="['/home']" routerLinkActive="router-link-active" >Back</span>
    <header class="font-bold text-3xl flex flex-col">
      Sales Purchase 
      <span>Agreement {{name}}</span>
    </header>
  </div>
  <div class="h-dvh bg-secondary rounded-t-4xl px-7 pt-6 overflow-auto">
    <form (ngSubmit)="submitPurchase()">
      <div class="mt-2">
        <div class="mt-2">
          <ion-item class="rounded-lg">
            <ion-select name="buyers_i_information_id" [(ngModel)]="purchaseField.buyers_i_information_id" label="Buyers Name" placeholder="Select Buyer">
              @for (buyer of BuyersList; track $index) {
                <ion-select-option value={{buyer.buyers_i_information_id}}>{{buyer.buyers_name}}</ion-select-option>
              }
            </ion-select>
          </ion-item>
        </div>
      </div>
      <div class="mt-2">
        <ion-item class="rounded-lg">
          <ion-select placeholder="Select Type" (ionChange)="onLotTypeChange($event)" label="Lot Type" placeholder="Lot Type">
            <ion-select-option value="">All Types</ion-select-option>
            <ion-select-option *ngFor="let type of lotTypes" [value]="type">{{ type }}</ion-select-option>
          </ion-select>
        </ion-item>
      </div>
      <div class="mt-2">
        <ion-item class="rounded-lg">
          <ion-select name="mp_i_lot_id" class=" !pl-0" [(ngModel)]="purchaseField.mp_i_lot_id"  label="Lot Area" placeholder="Lot Area">
            <ion-select-option class="!text-sm" *ngFor="let lot of filteredLots" [value]="lot.mp_i_lot_id">
              Area {{ lot.area_no }} - Block {{ lot.block_no }}  - Lot {{ lot.lot_no }}
            </ion-select-option>
          </ion-select>
        </ion-item>
      </div>
      <div class="mt-2">
        <div class="mt-1">
          <ion-item class="rounded-lg">
            <ion-select name="payment_type" [(ngModel)]="purchaseField.payment_type" label="Payment Type" placeholder="Payment Type">
              <ion-select-option value="Cash">Cash</ion-select-option>
              <ion-select-option value="Check">Check</ion-select-option>
              <ion-select-option value="Bank">Bank</ion-select-option>
              <ion-select-option value="Deposit">Deposit</ion-select-option>
              <ion-select-option value="Debt">Debt</ion-select-option>
              <ion-select-option value="Credit Balance">Credit Balance</ion-select-option>
            </ion-select>
          </ion-item>
        </div>
      </div>
      <div class="mt-2">
        <div class="mt-1">
          <ion-item class="rounded-lg">
            <ion-select name="terms" [(ngModel)]="purchaseField.terms" label="Terms" placeholder="Terms">
              <ion-select-option value="20">20 Years</ion-select-option>
              <ion-select-option value="10">10 Years</ion-select-option>
              <ion-select-option value="7">7 Years</ion-select-option>
              <ion-select-option value="5">5 Years</ion-select-option>
              <ion-select-option value="3">3 Years</ion-select-option>
              <ion-select-option value="1">1 Year</ion-select-option>
            </ion-select>
          </ion-item>
        </div>
      </div>
      <div class="mt-2">
        <label>Beneficiaries</label>
        <div class="mt-1">
          <div class="w-full flex flex-row items-center mt-1 gap-2 bg-white p-2 rounded-lg">
            <lucide-icon [img]="user"></lucide-icon>
            <input type="text" name="beneficiary1" [(ngModel)]="purchaseField.beneficiary1" class="w-full p-1 outline-none placeholder:text-black" placeholder="beneficiaries"/>
          </div>
        </div>
        <div class="mt-3">
          <div class="w-full flex flex-row items-center mt-1 gap-2 bg-white p-2 rounded-lg">
            <lucide-icon [img]="user"></lucide-icon>
            <input type="text" name="beneficiary2" [(ngModel)]="purchaseField.beneficiary2" class="w-full p-1 outline-none placeholder:text-black" placeholder="beneficiaries"/>
          </div>
        </div>
      </div>
      <div class="mt-2">
        <label>Payment Day</label>
        <div class="mt-1">
          <div class="w-full flex flex-row items-center mt-1 gap-2 bg-white p-2 rounded-lg">
            <lucide-icon [img]="calendar"></lucide-icon>
            <input type="text" name="datePayment" [(ngModel)]="purchaseField.datePayment" class="w-full p-1 outline-none placeholder:text-black" placeholder="Payment Day"/>
          </div>
        </div>
      </div>
      <div class="mt-4">
        <label class="block mb-2 font-medium">E-Signature</label>
        <canvas
          #canvas
          height="200"
          class="border border-gray-300 rounded-xl w-full"></canvas>

        <div class="flex justify-between mt-5 gap-3">
          <button type="button" (click)="clearSignature()" class="w-1/3 !p-3 py-1 bg-red-600 text-white !rounded-xl">
            Clear
          </button>
          <button type="button" (click)="saveSignature()" class="w-2/3 !p-3 bg-green-700 text-white !rounded-xl">
            Confirm Signature
          </button>
        </div>
      </div>
      <button class=" mb-4 w-full !p-4 !text-white bg-primary !mt-4 !rounded-full disabled:!bg-gray-500">
        Save Changes
      </button>
    </form>
  </div>
</div>