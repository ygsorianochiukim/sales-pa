<div class="flex flex-col items-center p-5 gap-4 min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
  <header class="font-bold text-4xl mb-4 text-gray-800">Scan Printed IDs</header>

  <!-- Stats Bar -->
  <div *ngIf="scannedIds.length > 0" class="w-full max-w-4xl bg-white rounded-xl shadow-lg p-4 flex justify-between items-center">
    <div class="flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </svg>
      <span class="font-semibold text-gray-800">Total Scanned: {{ scannedIds.length }}</span>
    </div>
    <button
      (click)="clearAll()"
      class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-all"
    >
      Clear All
    </button>
  </div>

  <!-- Camera Button -->
  <button
    *ngIf="!scanning && !capturedImage"
    (click)="startCamera()"
    class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-4 rounded-xl font-semibold shadow-lg transition-all transform hover:scale-105 flex items-center gap-3"
  >
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
      <circle cx="12" cy="13" r="4"></circle>
    </svg>
    {{ scannedIds.length > 0 ? 'Scan Next ID' : 'Start Scanning' }}
  </button>

  <!-- Captured Image Preview -->
  <div *ngIf="capturedImage && !loading" class="w-full max-w-md">
    <div class="relative rounded-xl overflow-hidden shadow-xl">
      <img [src]="capturedImage" alt="Captured ID" class="w-full">
      <button
        (click)="cancelScan()"
        class="absolute top-3 right-3 bg-red-500 hover:bg-red-600 text-white rounded-full p-2 shadow-lg transition-all"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="loading" class="flex flex-col items-center gap-4 mt-4">
    <div class="w-16 h-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin"></div>
    <p class="text-gray-700 font-medium text-lg">Processing ID {{ scannedIds.length + 1 }}...</p>
  </div>

  <!-- Current Scan Result -->
  <div *ngIf="currentPersonData && !loading" class="w-full max-w-md">
    <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-green-500">
      <div class="flex items-center justify-between mb-4 pb-4 border-b-2 border-gray-100">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </div>
          <h3 class="text-2xl font-bold text-gray-800">Successfully Scanned</h3>
        </div>
      </div>

      <div class="space-y-3">
        <div class="flex flex-col">
          <span class="text-sm text-gray-500 font-medium mb-1">ID Type</span>
          <span class="text-lg font-semibold text-indigo-600">{{ currentPersonData.idType }}</span>
        </div>

        <div class="flex flex-col">
          <span class="text-sm text-gray-500 font-medium mb-1">Full Name</span>
          <span class="text-lg font-semibold text-gray-800">{{ currentPersonData.name }}</span>
        </div>

        <div class="flex flex-col">
          <span class="text-sm text-gray-500 font-medium mb-1">ID Number</span>
          <span class="text-lg font-semibold text-gray-800">{{ currentPersonData.id }}</span>
        </div>

        <div class="flex flex-col">
          <span class="text-sm text-gray-500 font-medium mb-1">Position</span>
          <span class="text-lg font-semibold text-gray-800">{{ currentPersonData.position }}</span>
        </div>

        <div *ngIf="currentPersonData.dateOfBirth" class="flex flex-col">
          <span class="text-sm text-gray-500 font-medium mb-1">Date of Birth</span>
          <span class="text-lg font-semibold text-gray-800">{{ currentPersonData.dateOfBirth }}</span>
        </div>
      </div>

      <div class="flex gap-3 mt-6">
        <button
          (click)="saveAndContinue()"
          class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl font-semibold shadow-lg transition-all"
        >
          Save & Scan Next
        </button>
        <button
          (click)="cancelScan()"
          class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-3 rounded-xl font-semibold transition-all"
        >
          Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Scanned IDs List -->
  <div *ngIf="scannedIds.length > 0" class="w-full max-w-4xl mt-8">
    <div class="bg-white rounded-2xl shadow-xl p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Scanned IDs ({{ scannedIds.length }})</h2>
        <button
          (click)="exportToCSV()"
          class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Export CSV
        </button>
      </div>

      <!-- Search/Filter -->
      <div class="mb-4">
        <input
          type="text"
          [(ngModel)]="searchQuery"
          (ngModelChange)="filterIds()"
          placeholder="Search by name or ID..."
          class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-600 focus:outline-none"
        >
      </div>

      <!-- Table View -->
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-100 border-b-2 border-gray-200">
            <tr>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">#</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ID Type</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Name</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">ID Number</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Date of Birth</th>
              <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let person of filteredIds; let i = index" 
                class="border-b border-gray-200 hover:bg-gray-50 transition-colors"
                [class.bg-yellow-50]="person === currentPersonData">
              <td class="px-4 py-3 text-sm text-gray-600">{{ i + 1 }}</td>
              <td class="px-4 py-3">
                <span class="px-2 py-1 text-xs font-semibold rounded-full"
                      [class.bg-blue-100]="person.idType === 'Driver\'s License'"
                      [class.text-blue-800]="person.idType === 'Driver\'s License'"
                      [class.bg-green-100]="person.idType === 'UMID'"
                      [class.text-green-800]="person.idType === 'UMID'"
                      [class.bg-purple-100]="person.idType === 'SSS'"
                      [class.text-purple-800]="person.idType === 'SSS'"
                      [class.bg-orange-100]="person.idType === 'PAG-IBIG'"
                      [class.text-orange-800]="person.idType === 'PAG-IBIG'"
                      [class.bg-red-100]="person.idType === 'PhilHealth'"
                      [class.text-red-800]="person.idType === 'PhilHealth'"
                      [class.bg-gray-100]="!person.idType"
                      [class.text-gray-800]="!person.idType">
                  {{ person.idType || 'Unknown' }}
                </span>
              </td>
              <td class="px-4 py-3 text-sm font-medium text-gray-800">{{ person.name }}</td>
              <td class="px-4 py-3 text-sm text-gray-700">{{ person.id }}</td>
              <td class="px-4 py-3 text-sm text-gray-700">{{ person.dateOfBirth || '-' }}</td>
              <td class="px-4 py-3 text-center">
                <button
                  (click)="viewDetails(person)"
                  class="text-indigo-600 hover:text-indigo-800 font-medium text-sm mr-3"
                >
                  View
                </button>
                <button
                  (click)="deleteId(person)"
                  class="text-red-600 hover:text-red-800 font-medium text-sm"
                >
                  Delete
                </button>
              </td>
            </tr>
          </tbody>
        </table>

        <div *ngIf="filteredIds.length === 0" class="text-center py-8 text-gray-500">
          No matching IDs found
        </div>
      </div>
    </div>
  </div>

  <!-- Details Modal -->
  <div *ngIf="selectedPerson" 
       class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
       (click)="closeDetails()">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6" (click)="$event.stopPropagation()">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-2xl font-bold text-gray-800">ID Details</h3>
        <button (click)="closeDetails()" class="text-gray-500 hover:text-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div *ngIf="selectedPerson.image" class="mb-4 rounded-lg overflow-hidden">
        <img [src]="selectedPerson.image" alt="ID Image" class="w-full">
      </div>

      <div class="space-y-3">
        <div class="flex flex-col">
          <span class="text-sm text-gray-500 font-medium mb-1">ID Type</span>
          <span class="text-lg font-semibold text-gray-800">{{ selectedPerson.idType }}</span>
        </div>

        <div class="flex flex-col">
          <span class="text-sm text-gray-500 font-medium mb-1">Full Name</span>
          <span class="text-lg font-semibold text-gray-800">{{ selectedPerson.name }}</span>
        </div>

        <div class="flex flex-col">
          <span class="text-sm text-gray-500 font-medium mb-1">ID Number</span>
          <span class="text-lg font-semibold text-gray-800">{{ selectedPerson.id }}</span>
        </div>

        <div class="flex flex-col">
          <span class="text-sm text-gray-500 font-medium mb-1">Position</span>
          <span class="text-lg font-semibold text-gray-800">{{ selectedPerson.position }}</span>
        </div>

        <div *ngIf="selectedPerson.dateOfBirth" class="flex flex-col">
          <span class="text-sm text-gray-500 font-medium mb-1">Date of Birth</span>
          <span class="text-lg font-semibold text-gray-800">{{ selectedPerson.dateOfBirth }}</span>
        </div>

        <div *ngIf="selectedPerson.address" class="flex flex-col">
          <span class="text-sm text-gray-500 font-medium mb-1">Address</span>
          <span class="text-lg font-semibold text-gray-800">{{ selectedPerson.address }}</span>
        </div>

        <div *ngIf="selectedPerson.rawText" class="flex flex-col">
          <span class="text-sm text-gray-500 font-medium mb-1">Raw OCR Text</span>
          <div class="bg-gray-100 p-3 rounded text-xs font-mono text-gray-700 max-h-32 overflow-y-auto">
            {{ selectedPerson.rawText }}
          </div>
        </div>

        <div class="flex flex-col">
          <span class="text-sm text-gray-500 font-medium mb-1">Scanned At</span>
          <span class="text-sm text-gray-700">{{ selectedPerson.timestamp | date:'medium' }}</span>
        </div>
      </div>
    </div>
  </div>
</div>